# Environment Guide for AI Agents

## üîê SECURE API KEY CONFIGURATION (UPDATED)

**CRITICAL CHANGE**: All API keys now stored securely at `~/.config/artemis/env`

### New Secure Setup (MANDATORY)
```bash
# Secure location (outside git, 600 permissions)
~/.config/artemis/env  # 88+ API keys configured here
```

### Quick Setup
```bash
make artemis-setup  # Creates secure config
make env.check      # Validates setup
```

## üìÅ Environment File Strategy

### Current Files and Ownership

**Primary (SECURE)**
- `~/.config/artemis/env` - **ALL API KEYS HERE**
  - Purpose: Secure storage for all LLM and service API keys
  - Contents: OpenAI, Anthropic, XAI/Grok, OpenRouter, Groq, DeepSeek, etc.
  - Permissions: 600 (owner read/write only)
  - Location: Outside git repository (never committed)

**Infrastructure (this repo)**
- `.env.sophia` (optional)
  - Purpose: Infrastructure-only settings (DB URLs, Redis, etc.)
  - Contents: Business integrations, NO API KEYS
  - Policy: Orchestrator warns if LLM keys found here
  - Example: see `.env.sophia.example`

- `.env.mcp` (optional)
  - Purpose: MCP runtime configuration
  - Contents: MCP_MEMORY_HOST/PORT, MCP_BRIDGE_PORT, logging
  - Generated by ./unified-start.sh if missing
  - Example: see `.env.mcp.example`

**Legacy (being phased out)**
- `.env` (optional)
  - Purpose: Local testing fallback only
  - Status: Docker now uses secure location first
  - Contents: Minimal keys for quick tests (if any)

MCP & RAG Overview
- MCP memory (stdio) and MCP bridge (Node/TS) are started by the orchestrator.
- Optional RAG memory microservices run on HTTP:
  - sophia_memory: http://localhost:8767
  - artemis_memory: http://localhost:8768
  - Start with: ./unified-start.sh --with-rag

Quick Tips
- Use pyenv/devcontainer for Python 3.11.x where possible.
- Run preflight before boot: python3 scripts/agents_env_check.py
- For IDEs: start bridge: (cd mcp-bridge && npm install && npx tsx src/index.ts) if not using orchestrator.

SSH Agent Forwarding (Git MCP)
- Ensure an SSH agent is running and your key is loaded:
  - Start: eval "$(ssh-agent)"
  - Add key: ssh-add ~/.ssh/id_rsa (or your key path)
- Verify the socket: echo $SSH_AUTH_SOCK
- The multi-agent compose mounts SSH_AUTH_SOCK for the Git MCP container so pushes use your agent.
- Fallback: when SSH agent is not available, you can set a temporary GitHub PAT within the agent-dev shell for ad-hoc operations (avoid persisting secrets).

Personal Access Token (PAT) Fallback (Use Sparingly)
- Create a GitHub PAT with minimal scopes (e.g., repo)
- Inside the agent-dev shell, you can configure a one-off HTTPS remote:
  - git remote set-url origin https://github.com/<org>/<repo>.git
  - On push, provide PAT as password when prompted (username can be your GitHub handle)
- After use, restore SSH remote:
  - git remote set-url origin git@github.com:<org>/<repo>.git
- Do not store the PAT in files or environment; avoid adding to images or compose env.
