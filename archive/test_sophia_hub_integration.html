<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sophia Hub Integration Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0B0E14;
            color: #E4E6EB;
            padding: 20px;
            margin: 0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            background: rgba(37, 43, 61, 0.8);
            border: 1px solid #4A90E2;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .online { background: #10B981; }
        .offline { background: #EF4444; }
        .warning { background: #F59E0B; }
        button {
            background: #4A90E2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #3182BD; }
        .response {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 14px;
        }
        .error { border-left: 4px solid #EF4444; }
        .success { border-left: 4px solid #10B981; }
        .warning { border-left: 4px solid #F59E0B; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß† Sophia Hub Integration Test</h1>

        <div class="test-section">
            <h3><span class="status-indicator" id="serverStatus"></span>Server Connection Test</h3>
            <p>Testing connection to Sophia server on localhost:9000</p>
            <button onclick="testServerHealth()">Test Health Endpoint</button>
            <button onclick="testRootEndpoint()">Test Root API</button>
            <button onclick="testChatEndpoint()">Test Chat API</button>
            <div class="response" id="serverResponse"></div>
        </div>

        <div class="test-section">
            <h3>üì° API Endpoints Status</h3>
            <div id="endpointsStatus"></div>
        </div>

        <div class="test-section">
            <h3>üîß Integration Requirements</h3>
            <ul id="requirementsList">
                <li>‚úÖ Server running on port 9000</li>
                <li id="orchestratorReq">‚ùì Orchestrator initialization status</li>
                <li>‚úÖ CORS configuration for web UI</li>
                <li>‚úÖ Health check endpoint available</li>
                <li>‚úÖ Chat API endpoint structure</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>üöÄ Launch Sophia Intelligence Hub</h3>
            <p>Once all tests pass, you can launch the full Intelligence Hub:</p>
            <button onclick="openFullHub()" style="background: #10B981; font-size: 16px; padding: 15px 30px;">
                üß† Launch Sophia Intelligence Hub
            </button>
        </div>
    </div>

    <script>
        const baseUrl = 'http://localhost:9000';

        async function testServerHealth() {
            const responseDiv = document.getElementById('serverResponse');
            const statusIndicator = document.getElementById('serverStatus');

            try {
                responseDiv.innerHTML = 'Testing health endpoint...';
                const response = await fetch(`${baseUrl}/health`);
                const data = await response.json();

                responseDiv.innerHTML = `<strong>Health Check Response:</strong><br><pre>${JSON.stringify(data, null, 2)}</pre>`;

                if (response.ok) {
                    responseDiv.classList.add('success');
                    statusIndicator.className = 'status-indicator online';

                    // Update orchestrator requirement
                    const orchReq = document.getElementById('orchestratorReq');
                    if (data.orchestrator && data.orchestrator.status === 'active') {
                        orchReq.innerHTML = '‚úÖ Orchestrator is initialized and active';
                    } else {
                        orchReq.innerHTML = '‚ö†Ô∏è Orchestrator not initialized (server needs restart or initialization)';
                    }
                } else {
                    responseDiv.classList.add('error');
                    statusIndicator.className = 'status-indicator offline';
                }
            } catch (error) {
                responseDiv.innerHTML = `<strong>Connection Error:</strong><br>${error.message}`;
                responseDiv.classList.add('error');
                statusIndicator.className = 'status-indicator offline';
            }
        }

        async function testRootEndpoint() {
            const responseDiv = document.getElementById('serverResponse');

            try {
                responseDiv.innerHTML = 'Testing root API endpoint...';
                const response = await fetch(`${baseUrl}/`);
                const data = await response.json();

                responseDiv.innerHTML = `<strong>Root API Response:</strong><br><pre>${JSON.stringify(data, null, 2)}</pre>`;

                if (response.ok) {
                    responseDiv.classList.add('success');

                    // Update endpoints status
                    updateEndpointsStatus(data.endpoints);
                } else {
                    responseDiv.classList.add('error');
                }
            } catch (error) {
                responseDiv.innerHTML = `<strong>API Error:</strong><br>${error.message}`;
                responseDiv.classList.add('error');
            }
        }

        async function testChatEndpoint() {
            const responseDiv = document.getElementById('serverResponse');

            try {
                responseDiv.innerHTML = 'Testing chat API endpoint...';
                const response = await fetch(`${baseUrl}/api/sophia/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: 'Integration test message from Hub UI',
                        session_id: 'test_session_' + Date.now(),
                        user_id: 'hub_integration_test'
                    })
                });

                const data = await response.json();

                responseDiv.innerHTML = `<strong>Chat API Response:</strong><br><pre>${JSON.stringify(data, null, 2)}</pre>`;

                if (response.ok && data.success) {
                    responseDiv.classList.add('success');
                } else if (data.detail && data.detail.includes('not initialized')) {
                    responseDiv.classList.add('warning');
                    responseDiv.innerHTML += '<br><br><strong>Note:</strong> Server is running but orchestrator needs initialization. This is expected on first startup.';
                } else {
                    responseDiv.classList.add('error');
                }
            } catch (error) {
                responseDiv.innerHTML = `<strong>Chat API Error:</strong><br>${error.message}`;
                responseDiv.classList.add('error');
            }
        }

        function updateEndpointsStatus(endpoints) {
            const statusDiv = document.getElementById('endpointsStatus');
            let html = '<ul>';

            Object.entries(endpoints).forEach(([name, endpoint]) => {
                html += `<li><strong>${name}:</strong> <code>${endpoint}</code></li>`;
            });

            html += '</ul>';
            statusDiv.innerHTML = html;
        }

        function openFullHub() {
            window.open('sophia_intelligence_hub.html', '_blank');
        }

        // Auto-run initial test
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(testServerHealth, 500);
        });
    </script>
</body>
</html>
